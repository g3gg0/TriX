#title "symbian9.1_get_library_names"
#author "krisha"

#include trix

/* this script reads symbian .dso files and generates text
 * files with exported functions. line 1 is ordinal export 1 and so on
 *
 * purpose: use these textfiles than with a converter and your favourite
 * 	disassembler to have nice function names on e.g. symbian 9.1
 */

int main ()
{
	t_workspace *ws = NULL;
	t_workspace *ws2 = NULL;
	t_segment *seg = NULL;
	t_stage *stage = NULL;
	char *filename = NULL;
	int i = 0;
	int j = 0;
	
	// use your libs here! there are from S60-SDK-0616-3.0-mr.3.749 3rd gen.zip
	char *libfiles[] =
	{
		"agentdialog.dso",
		"agentdialog{000a0000}.dso",
		"aknicon.dso",
		"aknicon{000a0000}.dso",
		"akninputlanguage.dso",
		"akninputlanguage{000a0000}.dso",
		"aknnotify.dso",
		"aknnotify{000a0000}.dso",
		"aknpictograph.dso",
		"aknpictograph{000a0000}.dso",
		"aknskins.dso",
		"aknskinsrv.dso",
		"aknskinsrv{000a0000}.dso",
		"aknskins{000a0000}.dso",
		"aknswallpaperutils.dso",
		"aknswallpaperutils{000a0000}.dso",
		"alarmclient.dso",
		"alarmclient{000a0000}.dso",
		"alarmshared.dso",
		"alarmshared{000a0000}.dso",
		"apengine.dso",
		"apengine{000a0000}.dso",
		"apfile.dso",
		"apfile{000a0000}.dso",
		"apgrfx.dso",
		"apgrfx{000a0000}.dso",
		"apmime.dso",
		"apmime{000a0000}.dso",
		"apparc.dso",
		"apparc{000a0000}.dso",
		"apsettingshandlerui.dso",
		"apsettingshandlerui{000a0000}.dso",
		"asn1.dso",
		"asn1{000a0000}.dso",
		"audioequalizereffect.dso",
		"audioequalizereffect{000a0000}.dso",
		"audioequalizerutility.dso",
		"audioequalizerutility{000a0000}.dso",
		"avkon.dso",
		"avkon{000a0000}.dso",
		"bafl.dso",
		"bafl{000a0000}.dso",
		"bassboosteffect.dso",
		"bassboosteffect{000a0000}.dso",
		"bcardeng.dso",
		"bcardeng{000a0000}.dso",
		"bifu.dso",
		"bifu{000a0000}.dso",
		"bioc.dso",
		"bioc{000a0000}.dso",
		"biodb.dso",
		"biodb{000a0000}.dso",
		"bios.dso",
		"bios{000a0000}.dso",
		"bitgdi.dso",
		"bitgdi{000a0000}.dso",
		"bitmaptransforms.dso",
		"bitmaptransforms{000a0000}.dso",
		"biut.dso",
		"biut{000a0000}.dso",
		"bluetooth.dso",
		"bluetooth{000a0000}.dso",
		"bmpanim.dso",
		"bmpanim{000a0000}.dso",
		"bnf.dso",
		"bnf{000a0000}.dso",
		"browserengine.dso",
		"browserengine{000a0000}.dso",
		"btcmtm.dso",
		"btcmtm{000a0000}.dso",
		"btdevice.dso",
		"btdevice{000a0000}.dso",
		"btextnotifiers.dso",
		"btextnotifiers{000a0000}.dso",
		"btmanclient.dso",
		"btmanclient{000a0000}.dso",
		"c32.dso",
		"c32{000a0000}.dso",
		"caf.dso",
		"cafutils.dso",
		"cafutils{000a0000}.dso",
		"caf{000a0000}.dso",
		"caleninterimutils.dso",
		"caleninterimutils{000a0000}.dso",
		"calinterimapi.dso",
		"calinterimapi{000a0000}.dso",
		"ccon.dso",
		"ccon{000a0000}.dso",
		"centralrepository.dso",
		"centralrepository{000a0000}.dso",
		"certstore.dso",
		"certstore{000a0000}.dso",
		"charconv.dso",
		"charconv{000a0000}.dso",
		"clkdatetimeview.dso",
		"clkdatetimeview{000a0000}.dso",
		"clock.dso",
		"clock{000a0000}.dso",
		"cntmodel.dso",
		"cntmodel{000a0000}.dso",
		"cntview.dso",
		"cntview{000a0000}.dso",
		"commdb.dso",
		"commdb{000a0000}.dso",
		"commondialogs.dso",
		"commondialogs{000a0000}.dso",
		"commonengine.dso",
		"commonengine{000a0000}.dso",
		"commonui.dso",
		"commonui{000a0000}.dso",
		"commsdat.dso",
		"commsdat{000a0000}.dso",
		"conarc.dso",
		"conarc{000a0000}.dso",
		"cone.dso",
		"cone{000a0000}.dso",
		"connmon.dso",
		"connmon{000a0000}.dso",
		"convnames.dso",
		"convnames{000a0000}.dso",
		"convutils.dso",
		"convutils{000a0000}.dso",
		"crypto.dso",
		"crypto{000a0000}.dso",
		"ctframework.dso",
		"ctframework{000a0000}.dso",
		"dfpaeabi.dso",
		"dfpaeabi{000a0000}.dso",
		"dfprvct2_2.dso",
		"dfprvct2_2{000a0000}.dso",
		"dial.dso",
		"dial{000a0000}.dso",
		"distanceattenuationeffect.dso",
		"distanceattenuationeffect{000a0000}.dso",
		"dopplerbase.dso",
		"dopplerbase{000a0000}.dso",
		"downloadmgr.dso",
		"downloadmgruilib.dso",
		"downloadmgruilib{000a0000}.dso",
		"downloadmgr{000a0000}.dso",
		"drmaudioplayutility.dso",
		"drmaudioplayutility{000a0000}.dso",
		"drmhelper.dso",
		"drmhelper{000a0000}.dso",
		"drmlicensechecker.dso",
		"drmlicensechecker{000a0000}.dso",
		"drtaeabi.dso",
		"drtaeabi{000a0000}.dso",
		"drtrvct2_2.dso",
		"drtrvct2_2{000a0000}.dso",
		"dtdmdl.dso",
		"dtdmdl{000a0000}.dso",
		"ecam.dso",
		"ecam{000a0000}.dso",
		"ecmtclient.dso",
		"ecmtclient{000a0000}.dso",
		"ecom.dso",
		"ecom{000a0000}.dso",
		"econs.dso",
		"econs{000a0000}.dso",
		"edbms.dso",
		"edbms{000a0000}.dso",
		"effectbase.dso",
		"effectbase{000a0000}.dso",
		"efile.dso",
		"efile{000a0000}.dso",
		"efsrv.dso",
		"efsrv{000a0000}.dso",
		"egul.dso",
		"egul{000a0000}.dso",
		"eikcdlg.dso",
		"eikcdlg{000a0000}.dso",
		"eikcoctl.dso",
		"eikcoctl{000a0000}.dso",
		"eikcore.dso",
		"eikcore{000a0000}.dso",
		"eikctl.dso",
		"eikctl{000a0000}.dso",
		"eikdlg.dso",
		"eikdlg{000a0000}.dso",
		"eiksrv.dso",
		"eiksrvc.dso",
		"eiksrvc{000a0000}.dso",
		"eiksrv{000a0000}.dso",
		"ektran.dso",
		"ektran{000a0000}.dso",
		"environmentalreverbeffect.dso",
		"environmentalreverbeffect{000a0000}.dso",
		"environmentalreverbutility.dso",
		"environmentalreverbutility{000a0000}.dso",
		"eposlandmarks.dso",
		"eposlandmarks{000a0000}.dso",
		"eposlmdbmanlib.dso",
		"eposlmdbmanlib{000a0000}.dso",
		"eposlmmultidbsearch.dso",
		"eposlmmultidbsearch{000a0000}.dso",
		"eposlmsearchlib.dso",
		"eposlmsearchlib{000a0000}.dso",
		"esock.dso",
		"esocksvr.dso",
		"esocksvr{000a0000}.dso",
		"esock{000a0000}.dso",
		"estlib.dso",
		"estlib{000a0000}.dso",
		"estor.dso",
		"estor{000a0000}.dso",
		"etel.dso",
		"etel3rdparty.dso",
		"etel3rdparty{000a0000}.dso",
		"etel{000a0000}.dso",
		"etext.dso",
		"etext{000a0000}.dso",
		"euser.dso",
		"euser{000a0000}.dso",
		"exiflib.dso",
		"exiflib{000a0000}.dso",
		"ezip.dso",
		"ezip{000a0000}.dso",
		"ezlib.dso",
		"ezlib{000a0000}.dso",
		"f32agentui.dso",
		"f32agentui{000a0000}.dso",
		"favouritesengine.dso",
		"favouritesengine{000a0000}.dso",
		"faxcli.dso",
		"faxcli{000a0000}.dso",
		"faxio.dso",
		"faxio{000a0000}.dso",
		"faxstrm.dso",
		"faxstrm{000a0000}.dso",
		"faxsvr.dso",
		"faxsvr{000a0000}.dso",
		"fbscli.dso",
		"fbscli{000a0000}.dso",
		"featdiscovery.dso",
		"featdiscovery{000a0000}.dso",
		"fepbase.dso",
		"fepbase{000a0000}.dso",
		"field.dso",
		"field{000a0000}.dso",
		"flogger.dso",
		"flogger{000a0000}.dso",
		"fntstr.dso",
		"fntstr{000a0000}.dso",
		"fontutils.dso",
		"fontutils{000a0000}.dso",
		"form.dso",
		"form{000a0000}.dso",
		"ftpprot.dso",
		"ftpprot{000a0000}.dso",
		"ftpsess.dso",
		"ftpsess{000a0000}.dso",
		"gb2312_shared.dso",
		"gb2312_shared{000a0000}.dso",
		"gdi.dso",
		"gdi{000a0000}.dso",
		"gfp.dso",
		"gfp{000a0000}.dso",
		"gifscaler.dso",
		"gifscaler{000a0000}.dso",
		"grid.dso",
		"grid{000a0000}.dso",
		"gsmu.dso",
		"gsmu{000a0000}.dso",
		"hal.dso",
		"hal{000a0000}.dso",
		"hash.dso",
		"hash{000a0000}.dso",
		"hlplch.dso",
		"hlplch{000a0000}.dso",
		"hlpmodel.dso",
		"hlpmodel{000a0000}.dso",
		"http.dso",
		"http{000a0000}.dso",
		"hwrmlightclient.dso",
		"hwrmlightclient{000a0000}.dso",
		"hwrmvibraclient.dso",
		"hwrmvibraclient{000a0000}.dso",
		"imageconversion.dso",
		"imageconversion{000a0000}.dso",
		"imagetransform.dso",
		"imagetransform{000a0000}.dso",
		"imcm.dso",
		"imcm{000a0000}.dso",
		"imps.dso",
		"imps{000a0000}.dso",
		"imut.dso",
		"imut{000a0000}.dso",
		"inetprotutil.dso",
		"inetprotutil{000a0000}.dso",
		"insock.dso",
		"insock{000a0000}.dso",
		"irc.dso",
		"irc{000a0000}.dso",
		"irda.dso",
		"irda{000a0000}.dso",
		"irobex.dso",
		"irobex{000a0000}.dso",
		"irs.dso",
		"irs{000a0000}.dso",
		"irtranp.dso",
		"irtranp{000a0000}.dso",
		"jisx0201.dso",
		"jisx0201{000a0000}.dso",
		"jisx0208.dso",
		"jisx0208{000a0000}.dso",
		"jpegyuvdecoder.dso",
		"jpegyuvdecoder{000a0000}.dso",
		"lbs.dso",
		"lbs{000a0000}.dso",
		"libgles_cm.dso",
		"libgles_cm{000a0000}.dso",
		"linebreak.dso",
		"linebreak{000a0000}.dso",
		"listenerdopplereffect.dso",
		"listenerdopplereffect{000a0000}.dso",
		"listenerlocationeffect.dso",
		"listenerlocationeffect{000a0000}.dso",
		"listenerorientationeffect.dso",
		"listenerorientationeffect{000a0000}.dso",
		"lmkcommonui.dso",
		"lmkcommonui{000a0000}.dso",
		"locationbase.dso",
		"locationbase{000a0000}.dso",
		"logcli.dso",
		"logcli{000a0000}.dso",
		"logwrap.dso",
		"logwrap{000a0000}.dso",
		"loudnesseffect.dso",
		"loudnesseffect{000a0000}.dso",
		"mediaclientaudio.dso",
		"mediaclientaudioinputstream.dso",
		"mediaclientaudioinputstream{000a0000}.dso",
		"mediaclientaudiostream.dso",
		"mediaclientaudiostream{000a0000}.dso",
		"mediaclientaudio{000a0000}.dso",
		"mediaclientimage.dso",
		"mediaclientimage{000a0000}.dso",
		"mediaclientvideo.dso",
		"mediaclientvideo{000a0000}.dso",
		"mgfetch.dso",
		"mgfetch{000a0000}.dso",
		"midiclient.dso",
		"midiclient{000a0000}.dso",
		"mmfstandardcustomcommands.dso",
		"mmfstandardcustomcommands{000a0000}.dso",
		"mmscli.dso",
		"mmscli{000a0000}.dso",
		"msgeditorutils.dso",
		"msgeditorutils{000a0000}.dso",
		"msgs.dso",
		"msgs{000a0000}.dso",
		"mtur.dso",
		"mtur{000a0000}.dso",
		"netmeta.dso",
		"netmeta{000a0000}.dso",
		"nifman.dso",
		"nifman{000a0000}.dso",
		"npdlib.dso",
		"npdlib{000a0000}.dso",
		"numberconversion.dso",
		"numberconversion{000a0000}.dso",
		"obexclientmtm.dso",
		"obexclientmtm{000a0000}.dso",
		"obexmtmutil.dso",
		"obexmtmutil{000a0000}.dso",
		"obexservermtm.dso",
		"obexservermtm{000a0000}.dso",
		"orientationbase.dso",
		"orientationbase{000a0000}.dso",
		"palette.dso",
		"palette{000a0000}.dso",
		"pbkeng.dso",
		"pbkeng{000a0000}.dso",
		"pbkview.dso",
		"pbkview{000a0000}.dso",
		"pdrstr.dso",
		"pdrstr{000a0000}.dso",
		"pkcs10.dso",
		"pkcs10{000a0000}.dso",
		"pkixcert.dso",
		"pkixcert{000a0000}.dso",
		"platformenv.dso",
		"platformenv{000a0000}.dso",
		"pops.dso",
		"pops{000a0000}.dso",
		"powermgrcli.dso",
		"powermgrcli{000a0000}.dso",
		"prev.dso",
		"prev{000a0000}.dso",
		"print.dso",
		"print{000a0000}.dso",
		"ptiengine.dso",
		"ptiengine{000a0000}.dso",
		"pushmsgentry.dso",
		"pushmsgentry{000a0000}.dso",
		"random.dso",
		"random{000a0000}.dso",
		"redircli.dso",
		"redircli{000a0000}.dso",
		"remconclient.dso",
		"remconclient{000a0000}.dso",
		"remconcoreapi.dso",
		"remconcoreapi{000a0000}.dso",
		"remconextapi1.dso",
		"remconextapi1{000a0000}.dso",
		"remconinterfacebase.dso",
		"remconinterfacebase{000a0000}.dso",
		"remcontypes.dso",
		"remcontypes{000a0000}.dso",
		"richbio.dso",
		"richbio{000a0000}.dso",
		"satinfo.dso",
		"satinfo{000a0000}.dso",
		"scdv.dso",
		"scdv{000a0000}.dso",
		"schsvr.dso",
		"schsvr{000a0000}.dso",
		"scppnwdl.dso",
		"scppnwdl{000a0000}.dso",
		"sdpagent.dso",
		"sdpagent{000a0000}.dso",
		"sdpcodec.dso",
		"sdpcodec{000a0000}.dso",
		"sdpdatabase.dso",
		"sdpdatabase{000a0000}.dso",
		"securesocket.dso",
		"securesocket{000a0000}.dso",
		"sendas2.dso",
		"sendas2{000a0000}.dso",
		"sendui.dso",
		"sendui{000a0000}.dso",
		"senservconn.dso",
		"senservconn{000a0000}.dso",
		"senservdesc.dso",
		"senservdesc{000a0000}.dso",
		"senservmgr.dso",
		"senservmgr{000a0000}.dso",
		"senutils.dso",
		"senutils{000a0000}.dso",
		"senxml.dso",
		"senxml{000a0000}.dso",
		"sipclient.dso",
		"sipclient{000a0000}.dso",
		"sipcodec.dso",
		"sipcodec{000a0000}.dso",
		"sipprofilecli.dso",
		"sipprofilecli{000a0000}.dso",
		"smcm.dso",
		"smcm{000a0000}.dso",
		"smss.dso",
		"smss{000a0000}.dso",
		"smts.dso",
		"smts{000a0000}.dso",
		"sourcedopplereffect.dso",
		"sourcedopplereffect{000a0000}.dso",
		"sourcelocationeffect.dso",
		"sourcelocationeffect{000a0000}.dso",
		"sourceorientationeffect.dso",
		"sourceorientationeffect{000a0000}.dso",
		"spdctrl.dso",
		"spdctrl{000a0000}.dso",
		"ssl.dso",
		"ssl{000a0000}.dso",
		"stereowideningeffect.dso",
		"stereowideningeffect{000a0000}.dso",
		"stereowideningutility.dso",
		"stereowideningutility{000a0000}.dso",
		"sysutil.dso",
		"sysutil{000a0000}.dso",
		"tagma.dso",
		"tagma{000a0000}.dso",
		"timezonelocalization.dso",
		"timezonelocalization{000a0000}.dso",
		"tzclient.dso",
		"tzclient{000a0000}.dso",
		"uiklaf.dso",
		"uiklaf{000a0000}.dso",
		"undo.dso",
		"undo{000a0000}.dso",
		"vcal.dso",
		"vcal{000a0000}.dso",
		"vcard.dso",
		"vcard{000a0000}.dso",
		"versit.dso",
		"versit{000a0000}.dso",
		"vibractrl.dso",
		"vibractrl{000a0000}.dso",
		"viewcli.dso",
		"viewcli{000a0000}.dso",
		"wapmsgcli.dso",
		"wapmsgcli{000a0000}.dso",
		"wapp.dso",
		"wappushutils.dso",
		"wappushutils{000a0000}.dso",
		"wapp{000a0000}.dso",
		"watcher.dso",
		"watcher{000a0000}.dso",
		"wnode.dso",
		"wnode{000a0000}.dso",
		"worldclient.dso",
		"worldclient{000a0000}.dso",
		"wpeng.dso",
		"wpeng{000a0000}.dso",
		"ws32.dso",
		"ws32{000a0000}.dso",
		"wtlscert.dso",
		"wtlscert{000a0000}.dso",
		"wutil.dso",
		"wutil{000a0000}.dso",
		"x500.dso",
		"x500{000a0000}.dso",
		"x509.dso",
		"x509{000a0000}.dso",
		"xmlframework.dso",
		"xmlframework{000a0000}.dso",
		NULL
	};
	
	filename = (char*)malloc ( 100 );
	
	while ( libfiles[i++] )
	{
		// path changing maybe needed
		sprintf ( filename, "scripts\\standalone\\symbian91libs\\%s", libfiles[i-1] );
		ws = WorkspaceStartup ( filename );
		if ( ws )
			printf ( "%s loaded\n", libfiles[i-1] );
		else
			printf ( "%s NOT loaded\n", libfiles[i-1] );

		stage = __stage_find_by_num ( ws->memmap->stage, 1 );
		if ( !stage )
		{
			printf ( "error finding correct stage\n" );
		}
		seg = __segment_find_by_name ( stage->segments, ".strtab" );
		if ( !seg )
			printf ( "error finding right segment\n" );
		else
		{
			//replace 0x00 with \n
			for ( j = 0; j < seg->length; j++ )
			{
				if ( !seg->data[j] )
					seg->data[j] = '\n';
			}
			
			j = 0;
			if ( seg->data[0] == '\n' )
			{
				memmove ( seg->data, seg->data + 1, seg->length - 1 );
				j = -1;
			}
			
			//save as new file
			ws2 = WorkspaceCreateFileFromBuffer ( seg->data, seg->length + j );
			// path correction maybe needed
			sprintf ( filename, "scripts\\standalone\\symbian91libs\\%s.txt", libfiles[i-1] );

			__file_io_write ( filename, ws2->fileinfo );
			__workspace_release ( ws2 );
		
		}
		
		__workspace_release ( ws );
			
		
	}
	
	free ( filename );

	return E_OK;
}
